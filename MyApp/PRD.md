# 编织工具App PRD

## 1. 编织图解列表页（Home Page）
- 展示所有已保存的编织图解（pattern）
- 列表为双列竖排，元素包含：
  - 封面图（pattern的第一张图片）
  - 图解标题
- 页面底部有"add pattern"按钮，点击后跳转到新建pattern页面

## 2. 新建Pattern页面（Add Pattern Screen）

### 2.1 页面布局
- 顶部：关闭按钮（×）+ 页面标题"new pattern"
- 主体：三种导入方式的输入框

### 2.2 小红书链接导入功能 ✅ 已实现
- **输入界面**：
  - 链接输入框，占位符显示"link"
  - "add"按钮，点击后开始抓取
  - 抓取过程中显示loading状态，按钮不可点击
  
- **图片抓取**：
  - 后端API自动从小红书链接提取图片
  - 智能过滤头像、图标等无关图片
  - 只保留内容相关的高质量图片
  
- **图片管理界面**：
  - **大图预览**：1:1.25比例，显示当前选中图片
  - **缩略图列表**：水平滚动，显示所有抓取的图片
  - **图片选择**：点击缩略图切换大图预览，选中状态有蓝色边框
  - **删除功能**：每个缩略图右上角有删除按钮（×），点击后弹出确认对话框
  - **拖拽排序**：长按缩略图500ms后可拖拽重新排序，拖拽时禁用列表滚动
  - **添加更多图片**：缩略图列表末尾有"+"按钮，可从相册选择更多图片
  - **确认按钮**：底部"add"按钮，点击后进入下一步（编辑pattern名称）

### 2.3 图片上传功能 🚧 待实现
- 支持从相册选择多张图片
- 上传后可删除或改变图片顺序

### 2.4 PDF上传功能 ✅ 已实现
- 支持上传PDF文件并自动转换为图片
- 使用后端服务进行PDF转换，支持多页PDF
- 转换后的图片支持预览、删除和排序
- 支持高分辨率输出（2x缩放）
- 与其他图片来源共用相同的图片管理界面

### 2.5 技术实现细节
- **后端服务**：
  - Node.js + Express，端口3000
  - PDF转换服务：使用pdf-to-png-converter库
  - 文件上传：使用multer处理multipart/form-data
  - 图片服务：提供静态图片访问API
- **图片抓取**：双重策略（基础爬虫 + Puppeteer）
- **手势处理**：使用PanResponder实现拖拽排序
- **状态管理**：React hooks管理图片列表、选中状态等
- **用户体验**：Loading状态、错误处理、确认对话框等

## 3. 编辑Pattern名称页面 ✅ 已实现
- 允许用户为pattern输入自定义名称
- 预览选中的图片
- 保存pattern到本地存储

## 4. Pattern详情页面（Pattern Detail Screen） 🚧 开发中

### 4.1 页面结构
页面主要分为三个部分：
1. **导航标签栏**：pattern、pics、note
2. **内容展示区域**：根据选中标签显示对应内容
3. **计数器组件**：底部可展开的计数器面板

### 4.2 导航标签栏
- **pattern标签**：显示用户上传的pattern图片
- **pics标签**：显示用户拍摄的照片
- **note标签**：显示用户的笔记

### 4.3 内容展示

#### 4.3.1 Pattern图片内容
- **左右滑动预览**：支持手势滑动浏览图片
- **页码显示**：左上角显示"x/n"格式的页码
- **图片适配**：图片按比例缩放适应屏幕

#### 4.3.2 用户照片内容 ✅ 已实现
- **网格布局展示**：3列网格显示用户在该pattern中拍摄或添加的照片缩略图
- **相机入口**：左上角第一个方格位置为相机拍照入口，显示相机图标和"camera"文字
- **添加照片功能**：
  - 点击相机入口弹出底部菜单，提供"Camera"和"Photos"两个选项
  - **Camera**：调用系统相机拍照，拍摄完成后自动添加到pics列表
  - **Photos**：打开系统相册选择照片，支持多选，选择完成后添加到pics列表
- **照片管理**：
  - 每张照片右上角有删除按钮（×）
  - 长按照片也可触发删除确认对话框
  - 照片按1:1比例显示，自动裁剪适应网格
- **数据隔离**：每个pattern的照片独立存储，不同pattern之间照片不互通
- **权限处理**：自动请求相机和相册权限，权限被拒绝时显示提示信息

#### 4.3.3 笔记内容
- 展示用户编写的笔记
- 支持编辑和添加笔记

### 4.4 计数器组件（核心功能）

#### 4.4.1 计数器框展示形态
- **完全收起**：只显示向上箭头，占用最小空间
- **展开一部分**：默认形态，显示一个子计数器
- **展开更多部分**：最多显示3个子计数器，超过则可滚动

#### 4.4.2 展开交互
- **向上滑动**：从完全收起 → 展开一部分 → 展开更多部分
- **向下滑动**：展开更多部分 → 展开一部分 → 完全收起
- **固定位置**：计数器始终在页面底部，不受标签页切换影响

#### 4.4.3 子计数器类型

**Row计数器**：
- **元素**：名称（可为空）、当前行数、加减按钮、编辑按钮
- **交互**：点击"+"当前行+1，点击"-"当前行-1
- **配置**：名称、起始值、结束值

**Shape计数器**：
- **元素**：名称、当前times和加减按钮、当前rows和加减按钮、编辑按钮
- **交互**：分别控制times和rows的增减
- **配置**：名称、times值、rows值

#### 4.4.4 子计数器管理

**默认状态**：
- 用户首次进入时包含一个默认的行计数器（无名称）

**添加计数器功能**：
- **触发位置**：计数器框右上角的"+"按钮
- **选择界面**：点击"+"后弹出菜单，提供两个选项：
  - "+ row counter"：添加行计数器
  - "+ shape counter"：添加形状计数器
- **添加方式**：在当前计数器框中实现，不跳转新页面

**添加Row计数器**：
- **配置项**：
  - 名称输入框（可为空，使用下划线样式）
  - 起始值输入框（默认值1，灰色方框样式）
  - 结束值输入框（默认为空，灰色方框样式，显示"-"占位符）
- **交互逻辑**：
  - 点击起始值/结束值输入框弹出数字键盘
  - 数字验证：结束值必须大于起始值，两个值都不能为0
  - 底部"Add"按钮确认添加

**添加Shape计数器**：
- **配置项**：
  - 名称输入框（可为空，使用下划线样式）
  - Times值输入框（默认值1，灰色方框样式）
  - Rows值输入框（默认值1，灰色方框样式）
  - 连接状态控制（默认连接）
- **交互逻辑**：
  - 点击times/rows输入框弹出数字键盘
  - 中间连接线默认相连，表示两个值联动
  - 点击连接线可断开，表示两个值独立
  - 底部"Add"按钮确认添加

**其他管理功能**：
- **排序功能**：长按拖拽可调整子计数器顺序
- **滚动浏览**：超过3个计数器时支持上下滚动
- **编辑功能**：点击计数器的"edit"按钮可编辑配置

### 4.5 技术实现要点
- **标签页切换**：使用状态管理控制内容显示
- **手势处理**：PanResponder处理滑动和拖拽
- **动画效果**：计数器展开收起的平滑动画
- **状态持久化**：计数器数据的本地存储

## 5. 编织相册页
- 展示与该pattern相关的图片

## 6. 笔记页
- 记录与该pattern相关的笔记

---

## 开发进度
- ✅ **已完成**：
  - Home页面基础布局
  - 小红书链接抓取完整流程
  - Pattern信息编辑
  - Pics标签页功能
  - PDF上传和转换功能
- 🚧 **进行中**：Pattern详情页面（计数器组件）
- 📋 **待开发**：
  - 图片上传功能
  - 数据持久化
  - 笔记功能

## 技术栈
- **前端**：React Native + Expo
- **后端**：
  - Node.js + Express
  - pdf-to-png-converter（PDF转换）
  - multer（文件上传）
  - cors（跨域支持）
- **图片处理**：expo-image-picker
- **导航**：React Navigation
- **手势处理**：PanResponder
- **设计系统**：统一的Button和Input组件

---
> 以上为当前需求描述，后续如有补充会持续更新。 